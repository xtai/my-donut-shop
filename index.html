<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Sean Tai" />
    <link rel="icon" href="./assets/favicon.svg" />
    <title>My Donut Shop</title>
    <link href="./assets/bootstrap.min.css" rel="stylesheet" />
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');

      // Donut Shop Biz
      fbq('init', '915460960508331');
      fbq('init', '861610229332701');

      // Jasper Market Biz
      fbq('init', '1899581150495393');
      fbq('init', '970191988423649');

      // James's Business / My Donut Shop
      fbq('init', '38002360449920');

      // Lucky Shurb
      fbq('init', '1585204785655557');

      // Sean Biz
      fbq('init', '239218378685341');
      fbq('init', '609661981086441');
      fbq('track', 'PageView');
      setInterval(function() {
        if (typeof fbq === 'function') {
          console.log("fbq View Content");
          fbq('track', 'ViewContent');
        }
        if (typeof cbq === 'function') {
          console.log("cbq View Content");
          cbq('track', 'ViewContent');
        }
      }, 30000);
    </script>
    <script id="inject">
    </script>
  </head>
  <body class="bg-light-subtle vh-100">
    <div class="container-fluid p-3 h-100">
      <div class="row g-3 h-100">
        <div class="col-4 h-100 d-flex flex-column gap-2">
          <p class="h4">Website Code</p>
          <div class="border rounded-2 p-3 bg-white d-flex flex-column flex-fill gap-2">
            <div>
              <code>&lt;html&gt;<br /></code>
              <code class="ps-2">&lt;head&gt;<br /></code>
              <code class="ps-4">…</code>
            </div>
            <div class="ps-4 flex-fill d-flex">
              <div class="form-floating flex-fill">
                <textarea
                  wrap="off"
                  class="form-control h-100"
                  id="textarea"
                  style="font-family: monospace, monospace"></textarea>
                <label for="textarea">Add additional header code here</label>
              </div>
            </div>
            <div class="pb-4">
              <code class="ps-2">&lt;/head&gt;<br /></code>
              <code class="ps-2">&lt;body&gt;<br /></code>
              <code class="ps-4">…<br /></code>
              <code class="ps-2">&lt;/body&gt;<br /></code>
              <code>&lt;/html&gt;</code>
            </div>
            <div class="d-flex gap-2">
              <button type="button" class="btn btn-light" id="clear-button" onclick="textarea.value = ''; localStorage.setItem('donutShopHeaderValue', '');">Clear</button>
              <button type="button" class="btn btn-primary flex-grow-1" id="save-button">Save</button>
            </div>
          </div>
        </div>
        <div class="col h-100 d-flex flex-column g-3 gap-2">
          <p class="h4">Website</p>
          <div class="h-100 border border-primary-subtle bg-primary-subtle rounded-2 flex-fill" style="overflow: scroll;">
            <div id="preview" class="flex-fill">
              <nav class="container-fulid p-5" style="background-color: rgba(var(--bs-primary-rgb), .1)">
                <h1 class="text-center text-primary-emphasis">Welcome to My Donut Shop</h1>
              </nav>
              <div class="container" style="max-width: 720px">
                <div class="d-flex m-5 flex-column gap-4">
                  <div class="d-flex flex-row card p-3 gap-3 border-primary-subtle rounded-4">
                    <div class="border p-1 rounded-2 flex-shrink-0">
                      <img src="./assets/d1.jpg" class="img-fluid" width="200" alt="Donut Image" />
                    </div>
                    <div class="d-flex flex-column flex-grow-1">
                      <div class="flex-fill">
                        <h5>Glazed</h5>
                        <p><b id="donut-1-price">$3.00</b></p>
                        <p>A fluffy ring with a glazed frosting coating. Basically, the vanilla of donuts.</p>
                      </div>
                      <div>
                        <button type="button" class="btn btn-outline-primary" onclick="fbq('track', 'Purchase', {currency: 'USD', value: 3.0, content_ids: ['Glazed'], content_type: 'product'});" id="donut-1" data-value="3.0" data-currency="USD">Order Glazed</button>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-row card p-3 gap-3 border-primary-subtle rounded-4">
                    <div class="border p-1 rounded-2 flex-shrink-0">
                      <img src="./assets/d2.jpg" class="img-fluid" width="200" alt="Donut Image" />
                    </div>
                    <div class="d-flex flex-column flex-grow-1">
                      <div class="flex-fill">
                        <h5>Chocolate</h5>
                        <p><b id="donut-2-price">$3.50</b></p>
                        <p>It's a fluffy ring with chocolate on it. What more could you want?</p>
                      </div>
                      <div>
                        <button type="button" class="btn btn-outline-primary" onclick="fbq('track', 'Purchase', {currency: 'USD', value: 3.5, content_ids: ['Chocolate'], content_type: 'product'});" id="donut-2" data-value="3.5" data-currency="USD">Order Chocolate</button>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-row card p-3 gap-3 border-primary-subtle rounded-4">
                    <div class="border p-1 rounded-2 flex-shrink-0">
                      <img src="./assets/d3.jpg" class="img-fluid" width="200" alt="Donut Image" />
                    </div>
                    <div class="d-flex flex-column flex-grow-1">
                      <div class="flex-fill">
                        <h5>Sprinkles</h5>
                        <p><b id="donut-3-price">$3.50</b></p>
                        <p>A traditional cake ring with chocolate or maple frosting and some character-adding sprinkles.</p>
                      </div>
                      <div>
                        <button type="button" class="btn btn-outline-primary" onclick="fbq('track', 'Purchase', {currency: 'USD', value: 3.5, content_ids: ['Sprinkles'], content_type: 'product'});" id="donut-3" data-value="3.5" data-currency="USD">Order Sprinkles</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <footer class="container-fulid text-center p-5" style="background-color: rgba(var(--bs-primary-rgb), .1)">
                <p class="h4 text-primary-emphasis">My Donut Shop</p>
                <p>1621 Polk St, San Francisco<br />(555) 010-2368</p>
                <button type="button" class="btn btn-outline-primary" id="contact">Contact Us</button>
              </footer>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script defer>
      const textarea = document.getElementById('textarea');
      const loaclValue = localStorage.getItem('donutShopHeaderValue');
      const saveButton = document.getElementById('save-button');
      const inject = document.getElementById('inject');

      const regex = /<script>([\s\S]*?)<\/script>/g;

      if (loaclValue) {
        textarea.value = loaclValue;
        inject.innerHTML = loaclValue;
        let match;
        while ((match = regex.exec(loaclValue)) !== null) {
          eval(match[1]);
        }
      }

      saveButton.addEventListener('click', () => {
        localStorage.setItem('donutShopHeaderValue', textarea.value);
        inject.innerHTML = textarea.value;
        let match;
        while ((match = regex.exec(loaclValue)) !== null) {
          eval(match[1]);
        }
        // Change button text and style
        saveButton.textContent = "Saved!";
        saveButton.classList.remove("btn-primary");
        saveButton.classList.add("btn-light");
        // Revert button text and style after 1 second
        // setTimeout(() => {
        //   saveButton.textContent = "Save";
        //   saveButton.classList.remove("btn-light");
        //   saveButton.classList.add("btn-primary");
        // }, 3000);
      });
    </script>
  </body>
</html>
